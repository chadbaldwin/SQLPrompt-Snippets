{
  "id": "dd2d64e6-0a36-471d-8b74-d021f46f513f",
  "prefix": "qTableSizes",
  "description": "Table Sizes for current DB",
  "body": "SELECT x.TableName, x.SchemaName\n\t, RowCounts\t= RIGHT(SPACE(16) + FORMAT(x.RowCounts,'N0'), 16)\n\t, TotalKB\t= RIGHT(SPACE(16) + FORMAT(x.TotalKB  ,'N0'), 16)\n\t, TotalMB\t= RIGHT(SPACE(16) + FORMAT(x.TotalMB  ,'N2'), 16)\n\t, TotalGB\t= RIGHT(SPACE(16) + FORMAT(x.TotalGB  ,'N2'), 16)\n\t, UsedKB\t= RIGHT(SPACE(16) + FORMAT(x.UsedKB   ,'N0'), 16)\n\t, UsedMB\t= RIGHT(SPACE(16) + FORMAT(x.UsedMB   ,'N2'), 16)\n\t, UsedGB\t= RIGHT(SPACE(16) + FORMAT(x.UsedGB   ,'N2'), 16)\n\t, UnusedKB\t= RIGHT(SPACE(16) + FORMAT(x.UnusedKB ,'N0'), 16)\n\t, UnusedMB\t= RIGHT(SPACE(16) + FORMAT(x.UnusedMB ,'N2'), 16)\n\t, UnusedGB\t= RIGHT(SPACE(16) + FORMAT(x.UnusedGB ,'N2'), 16)\nFROM (\n\tSELECT x.TableName, x.SchemaName, x.RowCounts\n\t\t, TotalKB\t= x.TotalKB\n\t\t, TotalMB\t= x.TotalKB  / 1024.0\n\t\t, TotalGB\t= x.TotalKB  / 1024.0 / 1024.0\n\t\t, UsedKB\t= x.UsedKB\n\t\t, UsedMB\t= x.UsedKB   / 1024.0\n\t\t, UsedGB\t= x.UsedKB   / 1024.0 / 1024.0\n\t\t, UnusedKB\t= x.UnusedKB\n\t\t, UnusedMB\t= x.UnusedKB / 1024.0\n\t\t, UnusedGB\t= x.UnusedKB / 1024.0 / 1024.0\n\tFROM (\n\t\tSELECT TableName\t= t.[name]\n\t\t\t, SchemaName\t= SCHEMA_NAME(t.[schema_id])\n\t\t\t, RowCounts\t\t= p.[rows]\n\t\t\t, TotalKB\t\t= SUM(a.total_pages) * 8.0\n\t\t\t, UsedKB\t\t= SUM(a.used_pages) * 8.0\n\t\t\t, UnusedKB\t\t= (SUM(a.total_pages) - SUM(a.used_pages)) * 8.0\n\t\tFROM sys.tables t\n\t\t\tJOIN sys.indexes i ON t.[object_id] = i.[object_id]\n\t\t\tJOIN sys.partitions p ON i.[object_id] = p.[object_id] AND i.index_id = p.index_id\n\t\t\tJOIN sys.allocation_units a ON p.[partition_id] = a.container_id\n\t\tWHERE t.is_ms_shipped = 0\n\t\t\tAND i.[object_id] > 255 \n\t\tGROUP BY t.[name], SCHEMA_NAME(t.[schema_id]), p.[rows]\n\t) x\n) x\nORDER BY x.TotalKB DESC\n\n--Quick table count\nSELECT FORMAT(p.[rows], 'N0'), p.*\nFROM sys.partitions p\nWHERE p.[object_id] = OBJECT_ID('dbo.Service')\nORDER BY p.[rows] DESC"
}