{
  "id": "dd2d64e6-0a36-471d-8b74-d021f46f513f",
  "prefix": "qTableSizes",
  "description": "Table Sizes for current DB",
  "body": "\n-- Public Gist: https://gist.github.com/chadbaldwin/ab43b15faafb1a0b2476d64721c6cf07\n\nSELECT x.TableName, x.SchemaName, x.CompressionType\n\t, RowCounts\t\t\t= RIGHT(SPACE(16) + FORMAT(x.RowCounts\t\t,'N0'), 16)\n\t, TotalKB\t\t\t= RIGHT(SPACE(16) + FORMAT(x.TotalKB\t\t,'N0'), 16)\n\t, TotalMB\t\t\t= RIGHT(SPACE(16) + FORMAT(x.TotalMB\t\t,'N2'), 16)\n\t, TotalGB\t\t\t= RIGHT(SPACE(16) + FORMAT(x.TotalGB\t\t,'N2'), 16)\n\t, UsedKB\t\t\t= RIGHT(SPACE(16) + FORMAT(x.UsedKB\t\t\t,'N0'), 16)\n\t, UsedMB\t\t\t= RIGHT(SPACE(16) + FORMAT(x.UsedMB\t\t\t,'N2'), 16)\n\t, UsedGB\t\t\t= RIGHT(SPACE(16) + FORMAT(x.UsedGB\t\t\t,'N2'), 16)\n\t, UnusedKB\t\t\t= RIGHT(SPACE(16) + FORMAT(x.UnusedKB\t\t,'N0'), 16)\n\t, UnusedMB\t\t\t= RIGHT(SPACE(16) + FORMAT(x.UnusedMB\t\t,'N2'), 16)\n\t, UnusedGB\t\t\t= RIGHT(SPACE(16) + FORMAT(x.UnusedGB\t\t,'N2'), 16)\n\t, AvgRecordBytes\t= RIGHT(SPACE(16) + FORMAT(x.AvgRecordBytes\t,'N2'), 16)\nFROM (\n\tSELECT x.TableName, x.SchemaName, x.RowCounts, x.CompressionType\n\t\t, TotalKB\t\t\t= x.TotalKB\n\t\t, TotalMB\t\t\t= x.TotalKB  / 1024.0\n\t\t, TotalGB\t\t\t= x.TotalKB  / 1024.0 / 1024.0\n\t\t, UsedKB\t\t\t= x.UsedKB\n\t\t, UsedMB\t\t\t= x.UsedKB   / 1024.0\n\t\t, UsedGB\t\t\t= x.UsedKB   / 1024.0 / 1024.0\n\t\t, UnusedKB\t\t\t= x.UnusedKB\n\t\t, UnusedMB\t\t\t= x.UnusedKB / 1024.0\n\t\t, UnusedGB\t\t\t= x.UnusedKB / 1024.0 / 1024.0\n\t\t, AvgRecordBytes\t= COALESCE(x.TotalKB / NULLIF(x.RowCounts, 0) * 1024, 0)\n\tFROM (\n\t\tSELECT TableName\t\t= t.[name]\n\t\t\t, SchemaName\t\t= SCHEMA_NAME(t.[schema_id])\n\t\t\t, RowCounts\t\t\t= p.[rows]\n\t\t\t, TotalKB\t\t\t= SUM(a.total_pages) * 8.0\n\t\t\t, UsedKB\t\t\t= SUM(a.used_pages) * 8.0\n\t\t\t, UnusedKB\t\t\t= (SUM(a.total_pages) - SUM(a.used_pages)) * 8.0\n\t\t\t, CompressionType\t= CHOOSE(MAX(p.[data_compression])+1, 'NONE', 'ROW', 'PAGE')\n\t\tFROM sys.tables t\n\t\t\tJOIN sys.indexes i ON t.[object_id] = i.[object_id]\n\t\t\tJOIN sys.partitions p ON i.[object_id] = p.[object_id] AND i.index_id = p.index_id\n\t\t\tJOIN sys.allocation_units a ON p.[partition_id] = a.container_id\n\t\tWHERE t.is_ms_shipped = 0\n\t\t\tAND i.[object_id] > 255\n\t\t\tAND i.index_id <= 1 -- Heaps and clustered indexes only\n\t\tGROUP BY t.[name], SCHEMA_NAME(t.[schema_id]), p.[rows]\n\t) x\n) x\n\n--Quick table count\nSELECT FORMAT(p.[rows], 'N0'), p.*\nFROM sys.partitions p\nWHERE p.[object_id] = OBJECT_ID('dbo.Service')\nORDER BY p.[rows] DESC"
}