{
  "id": "a104c89f-4043-472c-b72e-1cf667fa2cbe",
  "name": "qGenerateTempTable",
  "prefix": "qGenerateTempTable",
  "description": "Generate a temp table using the query from the clipboard",
  "body": "DECLARE @sql nvarchar(MAX) = N'\n$PASTE$\n';\n\nSELECT CONCAT(IIF(column_ordinal = 1, 'CREATE TABLE #tmpTable (' + CHAR(13)+CHAR(10), NULL)\n\t\t, CHAR(9)\n\t\t, x.[name], REPLICATE(CHAR(9), CEILING((x.MaxColNameLen - LEN(x.[name])) / 4.0))\n\t\t, x.system_type_name, REPLICATE(CHAR(9), CEILING((x.MaxTypeNameLen - LEN(x.system_type_name)) / 4.0))\n\t\t, IIF(is_nullable = 1, CHAR(9) + 'NULL','NOT NULL'),','\n\t\t, IIF(x.column_ordinal = MAX(x.column_ordinal) OVER (), CHAR(13)+CHAR(10) + ')', NULL)\n\t)\nFROM (\n\tSELECT [name] = y.ColName, x.system_type_name, x.is_nullable, x.column_ordinal\n\t\t, MaxColNameLen = MAX(LEN(y.ColName)) OVER () + (4-(MAX(LEN(y.ColName)) OVER () % 4))\n\t\t, MaxTypeNameLen = MAX(LEN(x.system_type_name)) OVER () + (4-(MAX(LEN(x.system_type_name)) OVER () % 4))\n\tFROM sys.dm_exec_describe_first_result_set(@sql, NULL, 1) x\n\t\tCROSS APPLY (\n\t\t\tSELECT ColName = IIF(x.[name] IN (\n\t\t\t\t\t\t\t\t\t'action','address','application','data','date','day','dayofyear','definition','deny','description','enabled','endpoint',\n\t\t\t\t\t\t\t\t\t'expiredate','filename','hash','index','level','location','message','minutes','month','monthname','name','or','order',\n\t\t\t\t\t\t\t\t\t'password','path','population','port','priority','provider','quarter','rank','read','replace','role','row','rowcount',\n\t\t\t\t\t\t\t\t\t'sequence','server','source','state','status','subject','text','trim','type','uid','url','user','value','version','weekday',\n\t\t\t\t\t\t\t\t\t'year','object_id','schema_id','type_desc','lock_escalation','durability'\n\t\t\t\t\t\t\t\t) OR x.[name] LIKE '%[^a-z0-9_#]%', '['+x.[name]+']', x.[name])\n\t\t) y\n\tWHERE x.is_hidden = 0\n) x\nORDER BY x.column_ordinal",
  "placeholders": []
}